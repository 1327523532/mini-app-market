<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•/æ³¨å†Œ - Mini-Application</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .auth-container {
            max-width: 420px;
            margin: 60px auto;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 40px;
        }
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        .auth-tab.active {
            opacity: 1;
            border-bottom-color: #667eea;
        }
        .auth-form {
            display: none;
        }
        .auth-form.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .form-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1em;
        }
        .form-group input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(102,126,234,0.3);
        }
        .auth-submit {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
        }
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
        }
        .auth-switch a {
            color: #667eea;
            cursor: pointer;
        }
        .error-message {
            background: rgba(255,107,107,0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        .success-message {
            background: rgba(0,184,148,0.2);
            border: 1px solid #00b894;
            color: #00b894;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        .user-info {
            text-align: center;
            padding: 40px;
        }
        .user-info .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
        }
        .user-info .username {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .user-info .email {
            opacity: 0.7;
            margin-bottom: 30px;
        }
        .auth-links {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>ğŸš€ Mini-Application</h1>
        </div>
    </header>

    <main class="main">
        <div class="auth-container" id="authContainer">
            <!-- æœªç™»å½•çŠ¶æ€ -->
            <div id="authForms">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login" onclick="switchTab('login')">ç™»å½•</div>
                    <div class="auth-tab" data-tab="register" onclick="switchTab('register')">æ³¨å†Œ</div>
                </div>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>

                <!-- ç™»å½•è¡¨å• -->
                <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>é‚®ç®±</label>
                        <input type="email" id="loginEmail" required placeholder="è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="loginPassword" required placeholder="è¾“å…¥å¯†ç ">
                    </div>
                    <button type="submit" class="btn btn-primary auth-submit">ç™»å½•</button>
                    <div class="auth-switch">
                        è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a onclick="switchTab('register')">ç«‹å³æ³¨å†Œ</a>
                    </div>
                </form>

                <!-- æ³¨å†Œè¡¨å• -->
                <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" id="regUsername" required placeholder="è®¾ç½®ç”¨æˆ·å" minlength="2" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label>é‚®ç®±</label>
                        <input type="email" id="regEmail" required placeholder="è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="regPassword" required placeholder="è®¾ç½®å¯†ç " minlength="6">
                    </div>
                    <div class="form-group">
                        <label>ç¡®è®¤å¯†ç </label>
                        <input type="password" id="regPassword2" required placeholder="å†æ¬¡è¾“å…¥å¯†ç ">
                    </div>
                    <button type="submit" class="btn btn-primary auth-submit">æ³¨å†Œ</button>
                    <div class="auth-switch">
                        å·²æœ‰è´¦å·ï¼Ÿ<a onclick="switchTab('login')">ç«‹å³ç™»å½•</a>
                    </div>
                </form>
            </div>

            <!-- å·²ç™»å½•çŠ¶æ€ -->
            <div id="userInfo" style="display: none;">
                <div class="user-info">
                    <img class="avatar" id="userAvatar" src="" alt="å¤´åƒ">
                    <div class="username" id="userUsername"></div>
                    <div class="email" id="userEmail"></div>
                    <div class="auth-links">
                        <a href="profile.html" class="btn btn-primary">ä¸ªäººä¸»é¡µ</a>
                        <button class="btn btn-secondary" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>ğŸš€ Mini-Application å¾®åº”ç”¨å¸‚åœº</p>
    </footer>

    <script src="refactored-app.js"></script>
    <script>
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkAuth() {
            const user = userStorage.getCurrentUser();
            if (user) {
                showUserInfo(user);
            } else {
                showAuthForms();
            }
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            document.querySelectorAll('.auth-form').forEach(f => {
                f.classList.toggle('active', f.id === tab + 'Form');
            });
            hideMessages();
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(msg) {
            const el = document.getElementById('errorMessage');
            el.textContent = msg;
            el.style.display = 'block';
        }

        // æ˜¾ç¤ºæˆåŠŸ
        function showSuccess(msg) {
            const el = document.getElementById('successMessage');
            el.textContent = msg;
            el.style.display = 'block';
        }

        // éšè—æ¶ˆæ¯
        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // å¤„ç†ç™»å½•
        async function handleLogin(e) {
            e.preventDefault();
            hideMessages();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = userStorage.login(email, password);
            
            if (result.success) {
                showSuccess('ç™»å½•æˆåŠŸï¼');
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 1000);
            } else {
                showError(result.message);
            }
        }

        // å¤„ç†æ³¨å†Œ
        async function handleRegister(e) {
            e.preventDefault();
            hideMessages();
            
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const password2 = document.getElementById('regPassword2').value;
            
            // éªŒè¯å¯†ç 
            if (password !== password2) {
                showError('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            const result = userStorage.register(username, email, password);
            
            if (result.success) {
                showSuccess('æ³¨å†ŒæˆåŠŸï¼');
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 1000);
            } else {
                showError(result.message);
            }
        }

        // é€€å‡ºç™»å½•
        function handleLogout() {
            userStorage.logout();
            window.location.reload();
        }

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        function showUserInfo(user) {
            document.getElementById('authForms').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('userAvatar').src = user.avatar;
            document.getElementById('userUsername').textContent = user.username;
            document.getElementById('userEmail').textContent = user.email;
        }

        // æ˜¾ç¤ºç™»å½•è¡¨å•
        function showAuthForms() {
            document.getElementById('authForms').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
        }
    </script>
</body>
</html>
